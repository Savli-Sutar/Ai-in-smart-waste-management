<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Smart Waste Classifier</title>

<style>
body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    text-align: center;
    background-color: #f4f9f4;
    transition: background-color 0.5s ease;
    margin: 0;
    padding: 20px;
}

h1 { color: #2e7d32; margin-bottom: 5px; }
p.subtitle { color: #666; margin-bottom: 25px; }

#webcam-container {
    margin: 20px auto;
    border: 8px solid #2e7d32;
    border-radius: 20px;
    width: 400px;
    height: 400px;
    overflow: hidden;
    background-color: #000;
}

#label-container {
    margin: 20px 0;
    display: flex;
    justify-content: center;
    gap: 15px;
    flex-wrap: wrap;
}

#label-container div {
    font-size: 1.1rem;
    font-weight: bold;
    padding: 10px 20px;
    background: white;
    border-radius: 30px;
    color: #2e7d32;
}

#instructions {
    max-width: 520px;
    margin: 20px auto;
    background: white;
    padding: 20px;
    border-radius: 15px;
    text-align: left;
    box-shadow: 0 6px 15px rgba(0,0,0,0.1);
    display: none;
}

.waste-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    max-width: 1000px;
    margin: 40px auto;
}

.waste-card {
    background: white;
    border-radius: 15px;
    padding: 25px;
    border-bottom: 6px solid #ccc;
    opacity: 0.7;
    transition: 0.4s;
}

.active-card {
    opacity: 1;
    transform: scale(1.1);
}

.card-plastic { border-color: #3498db; }
.card-paper { border-color: #f1c40f; }
.card-metal { border-color: #95a5a6; }
.card-organic { border-color: #2ecc71; }
</style>
</head>

<body>

<h1>Smart Waste Classifier</h1>
<p class="subtitle">Point your trash at the camera to see how to dispose of it properly.</p>

<button onclick="init()">Start Camera</button>

<div id="webcam-container"></div>
<div id="label-container"></div>

<!-- Disposal Instructions -->
<div id="instructions">
    <h3 id="instruction-title"></h3>
    <ul id="instruction-list"></ul>
</div>

<div class="waste-grid">
    <div id="card-plastic" class="waste-card card-plastic"><h3>‚ôªÔ∏è Plastic</h3></div>
    <div id="card-paper" class="waste-card card-paper"><h3>üìÑ Paper</h3></div>
    <div id="card-metal" class="waste-card card-metal"><h3>ü•´ Metal</h3></div>
    <div id="card-organic" class="waste-card card-organic"><h3>üçé Organic</h3></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"></script>

<script>
const URL = "https://teachablemachine.withgoogle.com/models/qzbWj1b7y/";
let model, webcam, labelContainer, maxPredictions;

/* -------- FULL-SENTENCE DISPOSAL RULES -------- */
const disposalRules = {
    plastic: [
        "Please rinse the plastic item to remove any food or liquid residue before disposal.",
        "Ensure that bottle caps are kept tightly closed on plastic bottles.",
        "Do not place plastic bags, wrappers, or multilayer plastics in the recycling bin."
    ],
    paper: [
        "Make sure that all paper items are clean and completely dry before disposal.",
        "Flatten cardboard boxes to save space and improve recycling efficiency.",
        "Remove any plastic covers, laminated layers, or adhesive tapes from paper."
    ],
    metal: [
        "Rinse metal cans thoroughly to remove food or beverage residues.",
        "Only aluminum and steel containers should be placed in the metal recycling bin.",
        "Metal lids can be inserted inside the cans to avoid sharp edges."
    ],
    organic: [
        "Remove stickers, tags, or labels from fruits and vegetables before disposal.",
        "Ensure that no plastic, glass, or metal is mixed with organic waste.",
        "Organic waste can be composted to produce natural manure for plants."
    ]
};

function showInstructions(type) {
    const box = document.getElementById("instructions");
    const title = document.getElementById("instruction-title");
    const list = document.getElementById("instruction-list");

    title.innerText = type.charAt(0).toUpperCase() + type.slice(1) +
        " Waste Disposal Instructions";

    list.innerHTML = "";
    disposalRules[type].forEach(text => {
        const li = document.createElement("li");
        li.innerText = text;
        list.appendChild(li);
    });

    box.style.display = "block";
}

async function init() {
    model = await tmImage.load(URL + "model.json", URL + "metadata.json");
    maxPredictions = model.getTotalClasses();

    webcam = new tmImage.Webcam(400, 400, true);
    await webcam.setup();
    await webcam.play();

    document.getElementById("webcam-container").innerHTML = "";
    document.getElementById("webcam-container").appendChild(webcam.canvas);

    labelContainer = document.getElementById("label-container");
    labelContainer.innerHTML = "";
    for (let i = 0; i < maxPredictions; i++) {
        labelContainer.appendChild(document.createElement("div"));
    }

    window.requestAnimationFrame(loop);
}

async function loop() {
    webcam.update();
    await predict();
    window.requestAnimationFrame(loop);
}

async function predict() {
    const predictions = await model.predict(webcam.canvas);
    let bgColor = "#f4f9f4";

    document.querySelectorAll('.waste-card')
        .forEach(card => card.classList.remove('active-card'));

    for (let i = 0; i < predictions.length; i++) {
        const className = predictions[i].className.toLowerCase();
        const prob = predictions[i].probability;

        labelContainer.childNodes[i].innerHTML =
            className + ": " + (prob * 100).toFixed(0) + "%";

        if (prob > 0.85) {

            /* ---- FIX: use includes() instead of === ---- */

            if (className.includes("plastic")) {
                bgColor = "#d1ecf1";
                document.getElementById("card-plastic").classList.add("active-card");
                showInstructions("plastic");
            }
            else if (className.includes("paper")) {
                bgColor = "#fff3cd";
                document.getElementById("card-paper").classList.add("active-card");
                showInstructions("paper");
            }
            else if (className.includes("metal")) {
                bgColor = "#e2e3e5";
                document.getElementById("card-metal").classList.add("active-card");
                showInstructions("metal");
            }
            else if (className.includes("organic")) {
                bgColor = "#d4edda";
                document.getElementById("card-organic").classList.add("active-card");
                showInstructions("organic");
            }
        }
    }

    document.body.style.backgroundColor = bgColor;
}
</script>

</body>
</html>
