<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Smart Waste Classifier & Quiz</title>

<style>
:root{
    --primary:#2e7d32;
    --plastic:#3498db;
    --paper:#f1c40f;
    --metal:#95a5a6;
    --organic:#2ecc71;
    --wrong:#e74c3c;
}

body{
    font-family:'Segoe UI',sans-serif;
    text-align:center;
    background:#f4f9f4;
    margin:0;
    padding:20px;
    transition:0.5s;
}

h1{color:var(--primary);}

#webcam-container{
    margin:20px auto;
    width:400px;
    height:400px;
    border:8px solid var(--primary);
    border-radius:20px;
    background:black;
    overflow:hidden;
}

#label-container{
    display:flex;
    justify-content:center;
    gap:10px;
    flex-wrap:wrap;
    margin:15px 0;
}

#label-container div{
    background:#fff;
    padding:8px 15px;
    border-radius:20px;
    font-weight:bold;
}

button{
    background:var(--primary);
    color:#fff;
    padding:14px 40px;
    border:none;
    border-radius:50px;
    font-size:1.1rem;
    cursor:pointer;
}

.waste-grid{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(160px,1fr));
    gap:15px;
    max-width:900px;
    margin:40px auto;
}

.waste-card{
    background:#fff;
    padding:15px;
    border-radius:15px;
    border-bottom:6px solid #ccc;
    opacity:0.5;
    transition:0.3s;
}

.active-card{
    opacity:1;
    transform:scale(1.1);
}

.card-plastic{border-color:var(--plastic);}
.card-paper{border-color:var(--paper);}
.card-metal{border-color:var(--metal);}
.card-organic{border-color:var(--organic);}

/* Quiz */
#quiz-container{
    max-width:600px;
    margin:30px auto;
    background:#fff;
    padding:25px;
    border-radius:20px;
    box-shadow:0 10px 25px rgba(0,0,0,0.1);
}

.quiz-options{
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:10px;
    margin-top:20px;
}

.quiz-btn{
    padding:12px;
    border:2px solid #eee;
    border-radius:10px;
    cursor:pointer;
    font-weight:bold;
}

.quiz-btn:hover{background:#f9f9f9;}

#history-section{
    max-width:500px;
    margin:20px auto;
    background:#fff;
    padding:15px;
    border-radius:15px;
    border:1px dashed #ccc;
}

#history-log{
    list-style:none;
    padding:0;
    max-height:100px;
    overflow-y:auto;
}
</style>
</head>

<body>

<h1>Waste Management Smart Hub</h1>

<!-- QUIZ -->
<div id="quiz-container">
    <h2>üß† Recycling Quiz</h2>
    <p id="quiz-question"></p>

    <div class="quiz-options">
        <div class="quiz-btn" onclick="checkAnswer('plastic')">Plastic</div>
        <div class="quiz-btn" onclick="checkAnswer('paper')">Paper</div>
        <div class="quiz-btn" onclick="checkAnswer('metal')">Metal</div>
        <div class="quiz-btn" onclick="checkAnswer('organic')">Organic</div>
    </div>

    <div id="quiz-feedback"></div>
</div>

<hr style="width:50%;margin:40px auto;">

<h2>üì∑ AI Live Classifier</h2>
<button onclick="init()">Start Camera</button>

<div id="webcam-container"></div>
<div id="label-container"></div>

<div class="waste-grid">
    <div id="card-plastic" class="waste-card card-plastic"><h3>‚ôªÔ∏è Plastic</h3></div>
    <div id="card-paper" class="waste-card card-paper"><h3>üìÑ Paper</h3></div>
    <div id="card-metal" class="waste-card card-metal"><h3>ü•´ Metal</h3></div>
    <div id="card-organic" class="waste-card card-organic"><h3>üçé Organic</h3></div>
</div>

<div id="history-section">
    <strong>Session Scans</strong>
    <ul id="history-log"></ul>
</div>

<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"></script>

<script>
/* ---------------- QUIZ ---------------- */
const questions=[
 {q:"Where does a greasy pizza box go?",a:"organic",note:"Grease ruins paper recycling."},
 {q:"Where do soda cans go?",a:"metal",note:"Aluminum is infinitely recyclable."},
 {q:"Where do banana peels go?",a:"organic",note:"Perfect for compost."},
 {q:"Where do clean water bottles go?",a:"plastic",note:"Rinse before recycling."},
 {q:"Where do newspapers go?",a:"paper",note:"Keep them dry."}
];

let currentQ=0;

function loadQuestion(){
 currentQ=Math.floor(Math.random()*questions.length);
 document.getElementById("quiz-question").innerText=questions[currentQ].q;
 document.getElementById("quiz-feedback").innerHTML="";
}

function checkAnswer(choice){
 const fb=document.getElementById("quiz-feedback");
 if(choice===questions[currentQ].a){
   fb.innerHTML=<span style="color:var(--organic)">Correct! ${questions[currentQ].note}</span>;
   setTimeout(loadQuestion,2000);
 }else{
   fb.innerHTML=<span style="color:var(--wrong)">Not quite. Try again!</span>;
 }
}
loadQuestion();

/* ---------------- AI SCANNER ---------------- */
const URL="https://teachablemachine.withgoogle.com/models/qzbWj1b7y/";
let model,webcam,labelContainer;
let lastLogged="",lastTime=0;

async function init(){
 try{
   model=await tmImage.load(URL+"model.json",URL+"metadata.json");
   webcam=new tmImage.Webcam(400,400,true);
   await webcam.setup({facingMode:"environment"});
   await webcam.play();

   const cam=document.getElementById("webcam-container");
   cam.innerHTML="";
   cam.appendChild(webcam.canvas);

   labelContainer=document.getElementById("label-container");
   labelContainer.innerHTML="";
   for(let i=0;i<model.getTotalClasses();i++){
     labelContainer.appendChild(document.createElement("div"));
   }
   window.requestAnimationFrame(loop);
 }catch(e){
   alert("Camera error: "+e.message);
 }
}

async function loop(){
 webcam.update();
 await predict();
 requestAnimationFrame(loop);
}

async function predict(){
 const preds=await model.predict(webcam.canvas);
 let bg="#f4f9f4";

 document.querySelectorAll(".waste-card").forEach(c=>c.classList.remove("active-card"));

 preds.forEach((p,i)=>{
   const name=p.className.toLowerCase();
   const prob=p.probability;
   labelContainer.childNodes[i].innerHTML=${name}: ${(prob*100).toFixed(0)}%;

   if(prob>0.85){
     ["plastic","paper","metal","organic"].forEach(type=>{
       if(name.includes(type)){
         document.getElementById("card-"+type).classList.add("active-card");
         const colors={plastic:"#d1ecf1",paper:"#fff3cd",metal:"#e2e3e5",organic:"#d4edda"};
         bg=colors[type];

         if(type!==lastLogged || Date.now()-lastTime>4000){
           const li=document.createElement("li");
           li.innerHTML=<b>${type.toUpperCase()}</b> - ${new Date().toLocaleTimeString()};
           document.getElementById("history-log").prepend(li);
           lastLogged=type;
           lastTime=Date.now();
         }
       }
     });
   }
 });
 document.body.style.backgroundColor=bg;
}
</script>

</body>
</html>
